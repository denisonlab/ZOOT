---
title: "zoot_sdt_kt"
author: "Karen Tian"
date: "2025-05-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
suppressPackageStartupMessages(library(tidyverse))
library(tidyverse)
library(lme4)
# library(car)

knitr::opts_chunk$set(echo = TRUE)

#### anova setup #### 
options(contrasts=c("contr.sum","contr.poly"))

#### load data #### 
wd <- getwd()
analysisName = 'zoot_sdt_kt'
dataName <- sprintf("/Users/kantian/Dropbox/GitHub/ZOOT/kt_analysis/%s.csv", analysisName)
data <- read.csv(dataName)

#### Change to categorical vars ####
data$SID <- factor(data$SID) 
data$nonTargetContrast <- factor(data$nonTargetContrast)

# factorize target
data <- data %>%
  mutate(
    target = case_when(
      target == 1 ~ "T1",
      target == 2 ~ "T2",
      TRUE ~ NA_character_  # in case there are other values
    ),
    target = factor(target, levels = c("T1", "T2"), ordered = TRUE)
  )

# factorize validity
data <- data %>%
  mutate(
    validity = case_when(
      validity == 1 ~ "valid",
      validity == 2 ~ "neutral",
      validity == 3 ~ "invalid",
      TRUE ~ NA_character_  # in case there are other values
    ),
    validity = factor(validity, levels = c("valid","neutral","invalid"), ordered = TRUE)
  )
```

```{r anova_disSS, echo = TRUE}
m_anova = ezANOVA(
  data = data,
  dv = .(dis_dp_SS),
  wid = .(SID),
  within = .(validity,target,nonTargetContrast),
  detailed = TRUE,
  )
knitr::kable(m_anova, digits=3, caption=sprintf("Discrimination d'' SS"))

## Summary statistics
d <- data %>% group_by(validity) %>% 
  summarise(mean=mean(dis_dp_SS), sd=sd(dis_dp_SS), n=n_distinct(SID)) %>% mutate(se = sd / sqrt(n),
         ci.lower = mean - 1.96 * se,
         ci.upper = mean + 1.96 * se)
knitr::kable(d, digits=3, caption=sprintf("Discrimination d' SS summary"))
```

```{r anova_disSS, echo = TRUE}
d <- data # %>% filter(target=="T1") %>% filter(nonTargetContrast==1)
m_anova = ezANOVA(
  data = d,
  dv = .(det_dp_SS),
  wid = .(SID),
  within = .(validity,target,nonTargetContrast),
  detailed = TRUE,
  )
knitr::kable(m_anova, digits=3, caption=sprintf("Detection d'' SS"))

## Summary statistics
d <- d %>% group_by(validity) %>% 
  summarise(mean=mean(det_dp_SS), sd=sd(det_dp_SS), n=n_distinct(SID)) %>% mutate(se = sd / sqrt(n),
         ci.lower = mean - 1.96 * se,
         ci.upper = mean + 1.96 * se)
knitr::kable(d, digits=3, caption=sprintf("Detection d' SS summary"))
```





